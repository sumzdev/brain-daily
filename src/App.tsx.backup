import { useState, useEffect, useCallback } from 'react';
import { Brain, BarChart3, Flame, Clock, CheckCircle2, Play } from 'lucide-react';

// Types
type GameType = 'stroop' | 'nback' | 'decision' | 'summarization' | 'emotion' | 'breathing' | 'ifThen';
type GameStatus = 'pending' | 'playing' | 'completed';

interface GameResult {
  correct: boolean;
  details: any;
}

interface DailyProgram {
  id: GameType;
  name: string;
  description: string;
  status: GameStatus;
  score?: number;
  time?: number;
  results?: GameResult[];
}

interface UserStats {
  streak: number;
  totalSessionsCompleted: number;
  lastCompletedDate: string;
  scores: Record<string, number[]>;
}

// Main App
const BrainDaily = () => {
  const [currentView, setCurrentView] = useState<'dashboard' | 'game' | 'pomodoro' | 'stats'>('dashboard');
  const [currentGame, setCurrentGame] = useState<GameType | null>(null);
  const [dailyProgram, setDailyProgram] = useState<DailyProgram[]>([
    { id: 'stroop', name: 'Stroop Test', description: 'ìƒ‰ìƒ ì¸ì§€ ëŠ¥ë ¥ ê°•í™”', status: 'pending' },
    { id: 'nback', name: 'N-back Game', description: 'ì‘ì—… ê¸°ì–µ í›ˆë ¨', status: 'pending' },
    { id: 'decision', name: 'Decision Making', description: 'ì¦‰ê°ì  ë³´ìƒ vs ì¥ê¸°ì  ì´ìµ', status: 'pending' },
    { id: 'summarization', name: 'ìš”ì•½ í›ˆë ¨', description: 'ë³µì¡í•œ ì •ë³´ ì²˜ë¦¬ ëŠ¥ë ¥', status: 'pending' },
    { id: 'emotion', name: 'ê°ì • ë¼ë²¨ë§', description: 'í¸ë„ì²´ ì§„ì • ë° ê°ì • ì¡°ì ˆ', status: 'pending' },
  ]);
  const [userStats, setUserStats] = useState<UserStats>(() => {
    const saved = localStorage.getItem('brainDaily_stats');
    return saved ? JSON.parse(saved) : {
      streak: 0,
      totalSessionsCompleted: 0,
      lastCompletedDate: '',
      scores: {},
    };
  });

  // LocalStorage ì €ì¥
  useEffect(() => {
    localStorage.setItem('brainDaily_stats', JSON.stringify(userStats));
  }, [userStats]);

  // ì˜¤ëŠ˜ ì´ë¯¸ ì™„ë£Œí–ˆëŠ”ì§€ í™•ì¸
  useEffect(() => {
    const today = new Date().toISOString().split('T')[0];
    const wasCompletedToday = userStats.lastCompletedDate === today;
    
    if (!wasCompletedToday) {
      // ìƒˆë¡œìš´ ë‚ ì´ë©´ ë¦¬ì…‹
      setDailyProgram(prev => prev.map(p => ({ ...p, status: 'pending' })));
    }
  }, []);

  const handleGameComplete = (gameId: GameType, score: number, time: number, results?: GameResult[]) => {
    setDailyProgram(prev => 
      prev.map(p => p.id === gameId ? { ...p, status: 'completed', score, time, results } : p)
    );

    setUserStats(prev => ({
      ...prev,
      scores: {
        ...prev.scores,
        [gameId]: [...(prev.scores[gameId] || []), score],
      },
    }));

    // ëª¨ë“  ê²Œì„ ì™„ë£Œ í™•ì¸
    const allCompleted = dailyProgram.every(p => 
      p.id === gameId ? true : p.status === 'completed'
    );

    if (allCompleted) {
      const today = new Date().toISOString().split('T')[0];
      const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
      const isConsecutive = userStats.lastCompletedDate === yesterday;

      setUserStats(prev => ({
        ...prev,
        totalSessionsCompleted: prev.totalSessionsCompleted + 1,
        lastCompletedDate: today,
        streak: isConsecutive ? prev.streak + 1 : 1,
      }));
    }

    setCurrentView('dashboard');
  };

  const renderContent = () => {
    if (currentView === 'game' && currentGame) {
      return <GameRenderer gameId={currentGame} onComplete={handleGameComplete} />;
    }
    if (currentView === 'pomodoro') {
      return <PomodoroTimer />;
    }
    if (currentView === 'stats') {
      return <StatisticsView userStats={userStats} />;
    }
    
    return (
      <DashboardView
        dailyProgram={dailyProgram}
        userStats={userStats}
        onStartGame={(gameId) => {
          setCurrentGame(gameId as GameType);
          setCurrentView('game');
        }}
        onNavigate={(view) => setCurrentView(view as any)}
        onRetry={(gameId) => {
          setCurrentGame(gameId as GameType);
          setCurrentView('game');
        }}
      />
    );
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
      <div className="container mx-auto px-4 py-6">
        {/* Header */}
        <div className="flex items-center justify-between mb-8">
          <div className="flex items-center gap-3">
            <Brain className="w-8 h-8 text-purple-600" />
            <div>
              <h1 className="text-3xl font-bold text-gray-800">BrainDaily</h1>
              <p className="text-sm text-gray-600">ë§¤ì¼ ì „ë‘ì—½ì„ ê°•í™”í•˜ì„¸ìš”</p>
            </div>
          </div>
          <div className="flex gap-2">
            <button
              onClick={() => setCurrentView('dashboard')}
              className={`px-4 py-2 rounded-lg font-medium transition ${
                currentView === 'dashboard' ? 'bg-purple-600 text-white' : 'bg-white text-gray-700'
              }`}
            >
              ëŒ€ì‹œë³´ë“œ
            </button>
            <button
              onClick={() => setCurrentView('stats')}
              className={`px-4 py-2 rounded-lg font-medium transition ${
                currentView === 'stats' ? 'bg-purple-600 text-white' : 'bg-white text-gray-700'
              }`}
            >
              í†µê³„
            </button>
          </div>
        </div>

        {/* Main Content */}
        <div className="max-w-4xl mx-auto">
          {renderContent()}
        </div>
      </div>
    </div>
  );
};

// Dashboard
const DashboardView = ({ dailyProgram, userStats, onStartGame, onNavigate, onRetry }: { dailyProgram: any[]; userStats: any; onStartGame: (id: string) => void; onNavigate: (view: string) => void; onRetry: (id: string) => void }) => {
  const completedToday = dailyProgram.filter((p: any) => p.status === 'completed').length;
  const allCompleted = completedToday === dailyProgram.length;
  const [selectedGameDetails, setSelectedGameDetails] = useState<DailyProgram | null>(null);

  if (selectedGameDetails) {
    return <GameDetailsView game={selectedGameDetails} onBack={() => setSelectedGameDetails(null)} onRetry={onRetry} />;
  }

  return (
    <div className="space-y-6">
      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div className="bg-white rounded-lg p-6 shadow-sm border-l-4 border-red-500">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">ì—°ì† ì™„ë£Œ</p>
              <p className="text-3xl font-bold text-gray-800">{userStats.streak}</p>
            </div>
            <Flame className="w-8 h-8 text-red-500" />
          </div>
        </div>
        <div className="bg-white rounded-lg p-6 shadow-sm border-l-4 border-blue-500">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">ì´ ì™„ë£Œ ì„¸ì…˜</p>
              <p className="text-3xl font-bold text-gray-800">{userStats.totalSessionsCompleted}</p>
            </div>
            <CheckCircle2 className="w-8 h-8 text-blue-500" />
          </div>
        </div>
        <div className="bg-white rounded-lg p-6 shadow-sm border-l-4 border-purple-500">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600">ì˜¤ëŠ˜ ì§„í–‰</p>
              <p className="text-3xl font-bold text-gray-800">{completedToday}/5</p>
            </div>
            <Brain className="w-8 h-8 text-purple-500" />
          </div>
        </div>
      </div>

      {/* Daily Program */}
      <div className="bg-white rounded-lg p-6 shadow-sm">
        <h2 className="text-xl font-bold text-gray-800 mb-4">ì˜¤ëŠ˜ì˜ ì¸ì§€ í›ˆë ¨</h2>
        <div className="space-y-3">
          {dailyProgram.map((game: any) => (
            <div
              key={game.id}
              className="flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-100"
            >
              <div className="flex-1">
                <h3 className="font-semibold text-gray-800">{game.name}</h3>
                <p className="text-sm text-gray-600">{game.description}</p>
                {game.score !== undefined && (
                  <p className="text-sm text-green-600 font-medium mt-1">ì ìˆ˜: {game.score}</p>
                )}
              </div>
              <div className="flex gap-2">
                {game.status === 'pending' ? (
                  <button
                    onClick={() => onStartGame(game.id)}
                    className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition flex items-center gap-2"
                  >
                    <Play className="w-4 h-4" />
                    ì‹œì‘
                  </button>
                ) : (
                  <>
                    <div className="px-4 py-2 text-green-600 font-medium flex items-center gap-1">
                      <CheckCircle2 className="w-5 h-5" />
                      ì™„ë£Œ
                    </div>
                    {game.results && (
                      <button
                        onClick={() => setSelectedGameDetails(game)}
                        className="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition font-medium text-sm"
                      >
                        ìƒì„¸ë³´ê¸°
                      </button>
                    )}
                  </>
                )}
              </div>
            </div>
          ))}
        </div>

        {allCompleted && (
          <div className="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg text-center">
            <p className="text-green-800 font-semibold">ğŸ‰ ì˜¤ëŠ˜ì˜ í›ˆë ¨ì„ ëª¨ë‘ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!</p>
            <p className="text-sm text-green-700 mt-1">ë‚´ì¼ë„ í•¨ê»˜ ì „ë‘ì—½ì„ ê°•í™”í•´ë³´ì„¸ìš”.</p>
          </div>
        )}
      </div>

      {/* Quick Links */}
      <div className="grid grid-cols-2 gap-4">
        <button
          onClick={() => onNavigate('pomodoro')}
          className="bg-white rounded-lg p-4 shadow-sm hover:shadow-md transition text-center"
        >
          <Clock className="w-6 h-6 text-blue-600 mx-auto mb-2" />
          <p className="font-semibold text-gray-800">í¬ëª¨ë„ë¡œ</p>
          <p className="text-xs text-gray-600">ì§‘ì¤‘ ì‹œê°„ ê´€ë¦¬</p>
        </button>
        <button
          onClick={() => onNavigate('stats')}
          className="bg-white rounded-lg p-4 shadow-sm hover:shadow-md transition text-center"
        >
          <BarChart3 className="w-6 h-6 text-purple-600 mx-auto mb-2" />
          <p className="font-semibold text-gray-800">í†µê³„</p>
          <p className="text-xs text-gray-600">ì§„í–‰ë„ í™•ì¸</p>
        </button>
      </div>
    </div>
  );
};

// Game Renderer
const GameRenderer = ({ gameId, onComplete }: { gameId: GameType; onComplete: (id: GameType, score: number, time: number, results?: GameResult[]) => void }) => {

  switch (gameId) {
    case 'stroop':
      return <StroopTest onComplete={(score, time, results) => onComplete('stroop', score, time, results)} />;
    case 'nback':
      return <NBackGame onComplete={(score, time) => onComplete('nback', score, time)} />;
    case 'decision':
      return <DecisionMaking onComplete={(score, time) => onComplete('decision', score, time)} />;
    case 'summarization':
      return <SummarizationGame onComplete={(score, time, results) => onComplete('summarization', score, time, results)} />;
    case 'emotion':
      return <EmotionLabelingGame onComplete={(score, time) => onComplete('emotion', score, time)} />;
    case 'breathing':
      return <BreathingMeditation onComplete={(score, time) => onComplete('breathing', score, time)} />;
    case 'ifThen':
      return <IfThenPlanning onComplete={(score, time) => onComplete('ifThen', score, time)} />;
  }
};

// Stroop Test
const StroopTest = ({ onComplete }: { onComplete: (score: number, time: number, results: any) => void }) => {
  const colors = ['red', 'blue', 'green', 'yellow', 'purple'];
  const colorDisplay: { [key: string]: string } = { red: 'ë¹¨ê°•', blue: 'íŒŒë‘', green: 'ì´ˆë¡', yellow: 'ë…¸ë‘', purple: 'ë³´ë¼' };
  
  const [currentIndex, setCurrentIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [startTime] = useState(Date.now());
  const [testEnded, setTestEnded] = useState(false);
  const [testItems] = useState(() => {
    const items = [];
    for (let i = 0; i < 10; i++) {
      const textColor = colors[Math.floor(Math.random() * colors.length)];
      const displayColor = colors[Math.floor(Math.random() * colors.length)];
      items.push({ text: colorDisplay[textColor], displayColor, textColorName: textColor, correct: textColor === displayColor });
    }
    return items;
  });
  const [results, setResults] = useState<GameResult[]>([]);

  if (testEnded) {
    const timeTaken = Math.round((Date.now() - startTime) / 1000);
    const correctCount = results.filter(r => r.correct).length;

    return (
      <div className="max-w-2xl mx-auto">
        <div className="bg-white rounded-lg p-8 shadow-sm">
          <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center">Stroop Test ì™„ë£Œ</h2>
          
          {/* ì ìˆ˜ ìš”ì•½ */}
          <div className="mb-8 p-6 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg text-center border border-purple-200">
            <p className="text-gray-600 mb-2">ìµœì¢… ì ìˆ˜</p>
            <p className="text-4xl font-bold text-purple-600 mb-2">{correctCount}/10</p>
            <p className="text-sm text-gray-600">ì†Œìš” ì‹œê°„: {timeTaken}ì´ˆ</p>
          </div>

          {/* ë¬¸ì œë³„ ì •ë‹µ ìš”ì•½ */}
          <div className="mb-8">
            <h3 className="font-semibold text-gray-800 mb-4">ë¬¸ì œë³„ ê²°ê³¼</h3>
            <div className="space-y-3">
              {results.map((result, idx) => (
                <div
                  key={idx}
                  className={`p-3 rounded-lg border-l-4 ${
                    result.correct
                      ? 'bg-green-50 border-l-green-500 text-green-700'
                      : 'bg-red-50 border-l-red-500 text-red-700'
                  }`}
                >
                  <div className="flex items-center justify-between">
                    <span className="font-medium">ë¬¸ì œ {idx + 1}</span>
                    <span className={result.correct ? 'text-green-600' : 'text-red-600'}>
                      {result.correct ? 'âœ“ ì •ë‹µ' : 'âœ— ì˜¤ë‹µ'}
                    </span>
                  </div>
                  <p className="text-sm mt-1">
                    ìƒ‰ìƒ: <span style={{ color: result.details.displayColor }} className="font-bold">{result.details.displayColor}</span>
                    {!result.correct && ` â†’ ì •ë‹µ: ${result.details.textColorName}`}
                  </p>
                </div>
              ))}
            </div>
          </div>

          <button
            onClick={() => onComplete(score, timeTaken, results)}
            className="w-full px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-semibold"
          >
            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
          </button>
        </div>
      </div>
    );
  }

  const item = testItems[currentIndex];

  return (
    <div className="max-w-2xl mx-auto">
      <div className="bg-white rounded-lg p-8 shadow-sm">
        <h2 className="text-2xl font-bold text-gray-800 mb-2">Stroop Test</h2>
        <p className="text-gray-600 mb-6">ê¸€ì ìƒ‰ìƒì„ ì„ íƒí•˜ì„¸ìš” (ê¸€ì ì˜ë¯¸ì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤)</p>
        
        <div className="mb-8">
          <div className="text-6xl font-bold text-center mb-8" style={{ color: item.displayColor }}>
            {item.text}
          </div>

          <div className="grid grid-cols-2 gap-3 mb-6">
            {colors.map(color => (
              <button
                key={color}
                onClick={() => {
                  const isCorrect = color === item.displayColor;
                  if (isCorrect) {
                    setScore(score + 1);
                  }
                  setResults([...results, {
                    correct: isCorrect,
                    details: {
                      displayColor: item.displayColor,
                      textColorName: item.textColorName,
                      userAnswer: color,
                    }
                  }]);
                  
                  if (currentIndex >= testItems.length - 1) {
                    setTestEnded(true);
                  } else {
                    setCurrentIndex(currentIndex + 1);
                  }
                }}
                className="py-3 px-4 bg-gray-100 hover:bg-gray-200 rounded-lg font-semibold transition"
              >
                {colorDisplay[color]}
              </button>
            ))}
          </div>
        </div>

        <div className="w-full bg-gray-200 rounded-full h-2">
          <div className="bg-purple-600 h-2 rounded-full" style={{ width: `${((currentIndex + 1) / testItems.length) * 100}%` }} />
        </div>
        <p className="text-sm text-gray-600 mt-2">{currentIndex + 1}/{testItems.length}</p>
      </div>
    </div>
  );
};

// N-back Game
const NBackGame = ({ onComplete }: { onComplete: (score: number, time: number) => void }) => {
  const [sequence, setSequence] = useState<number[]>([]);
  const [score, setScore] = useState(0);
  const [startTime] = useState(Date.now());
  const [round, setRound] = useState(0);
  const [gameEnded, setGameEnded] = useState(false);
  const [isAutoPlaying, setIsAutoPlaying] = useState(false);
  const [feedback, setFeedback] = useState<{ correct: boolean; message: string } | null>(null);

  const generateSequence = useCallback(() => {
    const newSeq = [];
    for (let i = 0; i < 15; i++) {
      newSeq.push(Math.floor(Math.random() * 9)); // 0-8: 3x3 grid positions
    }
    return newSeq;
  }, []);

  useEffect(() => {
    if (sequence.length === 0) {
      setSequence(generateSequence());
    }
  }, []);

  useEffect(() => {
    if (isAutoPlaying && round < 2) {
      const timer = setTimeout(() => {
        setRound(round + 1);
      }, 1500);
      return () => clearTimeout(timer);
    } else if (isAutoPlaying && round >= 2) {
      setIsAutoPlaying(false);
    }
    return undefined;
  }, [isAutoPlaying, round]);

  const handleAnswer = useCallback((isMatch: boolean) => {
    const isCorrect = (sequence[round] === sequence[round - 2]) === isMatch;

    if (isCorrect) {
      setScore(prev => prev + 1);
      setFeedback({ correct: true, message: 'âœ“ ì •ë‹µ!' });
    } else {
      const expected = sequence[round] === sequence[round - 2] ? 'ì¼ì¹˜' : 'ë¶ˆì¼ì¹˜';
      setFeedback({ correct: false, message: `âœ— ì˜¤ë‹µ! ì •ë‹µ: ${expected}` });
    }

    setTimeout(() => {
      if (round >= 14) {
        setGameEnded(true);
      } else {
        setRound(round + 1);
        setFeedback(null);
      }
    }, 1200);
  }, [round, sequence]);

  if (gameEnded) {
    const timeTaken = Math.round((Date.now() - startTime) / 1000);
    return (
      <div className="max-w-2xl mx-auto">
        <div className="bg-white rounded-lg p-8 shadow-sm text-center">
          <h2 className="text-2xl font-bold text-gray-800 mb-4">N-back Game ì™„ë£Œ</h2>
          <div className="mb-6">
            <p className="text-gray-600">ìµœì¢… ì ìˆ˜</p>
            <p className="text-4xl font-bold text-purple-600">{score}/13</p>
            <p className="text-sm text-gray-500 mt-2">ì •í™•ë„: {Math.round((score / 13) * 100)}%</p>
          </div>
          <p className="text-gray-600 mb-6">ì†Œìš” ì‹œê°„: {timeTaken}ì´ˆ</p>
          <button
            onClick={() => onComplete(Math.round((score / 13) * 100), timeTaken)}
            className="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition"
          >
            ì™„ë£Œ
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="max-w-2xl mx-auto">
      <div className="bg-white rounded-lg p-8 shadow-sm">
        <h2 className="text-2xl font-bold text-gray-800 mb-2">N-back Game (2-back)</h2>
        <p className="text-gray-600 mb-6">í˜„ì¬ ìœ„ì¹˜ê°€ 2ì¹¸ ì „ ìœ„ì¹˜ì™€ ê°™ìœ¼ë©´ "ì¼ì¹˜"ë¥¼ ëˆ„ë¥´ì„¸ìš”</p>

        <div className="mb-8 text-center">
          {!isAutoPlaying && round < 2 && (
            <button
              onClick={() => setIsAutoPlaying(true)}
              className="px-8 py-4 bg-blue-600 text-white text-lg font-semibold rounded-lg hover:bg-blue-700 transition mb-6"
            >
              ì‹œì‘í•˜ê¸°
            </button>
          )}

          {(isAutoPlaying || round >= 2) && round < 15 && (
            <div className="mb-6">
              <div className="mb-8">
                <p className="text-sm text-gray-600 mb-4">ğŸ¯ ìœ„ì¹˜ë¥¼ ê¸°ì–µí•˜ì„¸ìš”</p>

                {/* 3x3 Grid */}
                <div className="grid grid-cols-3 gap-3 max-w-xs mx-auto mb-6">
                  {[0, 1, 2, 3, 4, 5, 6, 7, 8].map((position) => (
                    <div
                      key={position}
                      className={`aspect-square rounded-lg transition-all duration-300 ${
                        sequence[round] === position
                          ? 'bg-blue-600 shadow-lg scale-105'
                          : 'bg-gray-200'
                      }`}
                    />
                  ))}
                </div>
              </div>

              {isAutoPlaying && round < 2 && (
                <div className="mb-6 p-3 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg font-semibold text-center">
                  â„¹ï¸ ìœ„ì¹˜ë¥¼ ê¸°ì–µí•˜ì„¸ìš” ({round + 1}/2)
                </div>
              )}

              {round >= 2 && !feedback && (
                <div className="mb-6 p-3 bg-purple-50 text-purple-700 border border-purple-200 rounded-lg font-semibold text-center">
                  â“ í˜„ì¬ ìœ„ì¹˜ê°€ 2ì¹¸ ì „ ìœ„ì¹˜ì™€ ê°™ë‚˜ìš”?
                </div>
              )}

              {feedback && (
                <div className={`mb-6 p-3 rounded-lg font-semibold text-center ${
                  feedback.correct
                    ? 'bg-green-50 text-green-700 border border-green-200'
                    : 'bg-red-50 text-red-700 border border-red-200'
                }`}>
                  {feedback.message}
                </div>
              )}

              {round >= 2 && (
                <div className="grid grid-cols-2 gap-3 max-w-sm mx-auto">
                  <button
                    onClick={() => handleAnswer(true)}
                    disabled={feedback !== null}
                    className="py-4 bg-green-600 text-white text-lg rounded-lg hover:bg-green-700 disabled:bg-gray-400 font-semibold transition"
                  >
                    ì¼ì¹˜ âœ“
                  </button>
                  <button
                    onClick={() => handleAnswer(false)}
                    disabled={feedback !== null}
                    className="py-4 bg-red-600 text-white text-lg rounded-lg hover:bg-red-700 disabled:bg-gray-400 font-semibold transition"
                  >
                    ë¶ˆì¼ì¹˜ âœ—
                  </button>
                </div>
              )}
            </div>
          )}
        </div>

        <div className="w-full bg-gray-200 rounded-full h-2">
          <div className="bg-purple-600 h-2 rounded-full transition-all" style={{ width: `${((round + 1) / 15) * 100}%` }} />
        </div>
        <p className="text-sm text-gray-600 mt-2 text-center">
          ì§„í–‰ë¥ : {Math.min(round + 1, 15)}/15 | ì ìˆ˜: {score}
        </p>
      </div>
    </div>
  );
};

// Decision Making
const DecisionMaking = ({ onComplete }: { onComplete: (score: number, time: number) => void }) => {
  const scenarios = [
    {
      situation: 'ìœ íŠœë¸Œ ìˆì¸ ë¥¼ ë³´ë‹¤ê°€ 30ë¶„ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤. ì§€ê¸ˆ ì´ ìˆœê°„ ë‹¹ì‹ ì˜ ì„ íƒì€?',
      options: [
        { text: '\'í•œ ê°œë§Œ ë”\' í•˜ê³  ê³„ì† ë³¸ë‹¤', value: 0 },
        { text: 'ì•±ì„ ë„ê³  ì›ë˜ í•  ì¼ë¡œ ëŒì•„ê°„ë‹¤', value: 10 },
        { text: 'íƒ€ì´ë¨¸ë¥¼ 5ë¶„ ì„¤ì •í•˜ê³  ì¡°ê¸ˆ ë” ë³¸ë‹¤', value: 6 },
      ],
    },
    {
      situation: 'í”„ë¡œì íŠ¸ ë§ˆê°ì´ 3ì¼ ë‚¨ì•˜ìŠµë‹ˆë‹¤. 50% ì™„ì„±í–ˆê³ , ì¹œêµ¬ê°€ ì €ë… ì•½ì†ì„ ì œì•ˆí•©ë‹ˆë‹¤.',
      options: [
        { text: 'ì•½ì†ì„ ì¡ë˜, ë‚´ì¼ ë‘ ë°°ë¡œ ì§‘ì¤‘í•´ì„œ ë§ŒíšŒí•œë‹¤', value: 4 },
        { text: 'ì •ì¤‘íˆ ê±°ì ˆí•˜ê³  ì‘ì—…ì— ì§‘ì¤‘í•œë‹¤', value: 10 },
        { text: 'ì§§ê²Œ ë§Œë‚˜ê³  ì¼ì° ëŒì•„ì˜¨ë‹¤', value: 7 },
      ],
    },
    {
      situation: 'ì–´ë ¤ìš´ ì½”ë“œ ë¬¸ì œë¡œ 2ì‹œê°„ì§¸ ë§‰í˜€ìˆìŠµë‹ˆë‹¤. ë‹µë‹µí•¨ì´ ê·¹ì— ë‹¬í•©ë‹ˆë‹¤.',
      options: [
        { text: 'SNSë¥¼ ë³´ë©° ê¸°ë¶„ ì „í™˜ì„ í•œë‹¤', value: 2 },
        { text: 'ë¬¸ì œë¥¼ ì •ë¦¬í•˜ê³  ë‹¤ë¥¸ ì ‘ê·¼ë²•ì„ ì‹œë„í•œë‹¤', value: 10 },
        { text: 'ì¼ë‹¨ ë‹¤ë¥¸ ì‰¬ìš´ ì‘ì—…ë¶€í„° ì²˜ë¦¬í•œë‹¤', value: 6 },
      ],
    },
    {
      situation: 'ìì •ì´ ë„˜ì—ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆ ìë©´ ë‚´ì¼ í”¼ê³¤í•˜ê³ , ë”í•˜ë©´ ì˜¤ëŠ˜ ì¼ì´ ì™„ì„±ë©ë‹ˆë‹¤.',
      options: [
        { text: 'ì™„ì„±ë„ë¥¼ ìœ„í•´ ëê¹Œì§€ ë§ˆë¬´ë¦¬í•œë‹¤', value: 5 },
        { text: 'ì§€ê¸ˆ ìê³  ë‚´ì¼ ì•„ì¹¨ ì¼ì° ì¼ì–´ë‚˜ ë§ˆë¬´ë¦¬í•œë‹¤', value: 10 },
        { text: 'ëŒ€ì¶© ë§ˆë¬´ë¦¬í•˜ê³  ì”ë‹¤', value: 3 },
      ],
    },
    {
      situation: 'ì•Œë¦¼ì´ ê³„ì† ì˜µë‹ˆë‹¤. ì§€ê¸ˆ ì§‘ì¤‘ì´ í•„ìš”í•œ ì‘ì—… ì¤‘ì…ë‹ˆë‹¤.',
      options: [
        { text: 'ì•Œë¦¼ì„ í™•ì¸í•˜ë©´ì„œ ì‘ì—…í•œë‹¤ (ë©€í‹°íƒœìŠ¤í‚¹)', value: 2 },
        { text: 'ë°©í•´ê¸ˆì§€ ëª¨ë“œë¥¼ ì¼œê³  ì‘ì—…í•œë‹¤', value: 10 },
        { text: 'ì¤‘ìš”í•œ ì•Œë¦¼ë§Œ í™•ì¸í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ë¬´ì‹œí•œë‹¤', value: 7 },
      ],
    },
    {
      situation: 'ìƒˆ ì•„ì´ë””ì–´ê°€ ë– ì˜¬ëì§€ë§Œ, í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ì¼ì´ ìˆìŠµë‹ˆë‹¤.',
      options: [
        { text: 'ì§€ê¸ˆ ë‹¹ì¥ ìƒˆ ì•„ì´ë””ì–´ë¥¼ ì‹œì‘í•œë‹¤', value: 3 },
        { text: 'ë©”ëª¨ë§Œ í•´ë‘ê³  í˜„ì¬ ì¼ì— ì§‘ì¤‘í•œë‹¤', value: 10 },
        { text: 'í˜„ì¬ ì¼ì„ ë¹¨ë¦¬ ëŒ€ì¶© ëë‚´ê³  ìƒˆ ì¼ì„ ì‹œì‘í•œë‹¤', value: 4 },
      ],
    },
    {
      situation: 'ì˜¨ë¼ì¸ ì‡¼í•‘ ì¤‘ í•œì • ì„¸ì¼ ì•Œë¦¼ì´ ì™”ìŠµë‹ˆë‹¤. 30ë¶„ í›„ ì¢…ë£Œë©ë‹ˆë‹¤.',
      options: [
        { text: 'ë†“ì¹˜ê¸° ì•„ê¹Œìš°ë‹ˆê¹Œ ì§€ê¸ˆ ë°”ë¡œ êµ¬ë§¤í•œë‹¤', value: 2 },
        { text: 'ì •ë§ í•„ìš”í•œì§€ í•˜ë£¨ ë” ìƒê°í•´ë³¸ë‹¤', value: 10 },
        { text: 'ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•„ë‘ê³  ì„¸ì¼ ì¢…ë£Œ ì§ì „ì— ê²°ì •í•œë‹¤', value: 6 },
      ],
    },
    {
      situation: 'ìš´ë™í•˜ë ¤ í–ˆëŠ”ë° ëª¸ì´ í”¼ê³¤í•©ë‹ˆë‹¤. ì˜¤ëŠ˜ ì´ë¯¸ 2ì¼ ì—°ì† ì•ˆ í–ˆìŠµë‹ˆë‹¤.',
      options: [
        { text: 'ì˜¤ëŠ˜ì€ ì‰¬ê³  ë‚´ì¼ ë” ì—´ì‹¬íˆ í•œë‹¤', value: 3 },
        { text: '10ë¶„ì´ë¼ë„ ê°€ë³ê²Œ ì›€ì§ì¸ë‹¤', value: 10 },
        { text: 'ìŠ¤íŠ¸ë ˆì¹­ë§Œ í•˜ê³  ë³¸ ìš´ë™ì€ íŒ¨ìŠ¤í•œë‹¤', value: 7 },
      ],
    },
  ];

  const [currentIndex, setCurrentIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [startTime] = useState(Date.now());
  const [gameEnded, setGameEnded] = useState(false);

  if (gameEnded) {
    const timeTaken = Math.round((Date.now() - startTime) / 1000);
    const maxScore = 80; // 8 questions Ã— 10 points
    const percentage = Math.round((score / maxScore) * 100);

    let feedback = '';
    if (percentage >= 90) feedback = 'ì™„ë²½í•´ìš”! ì „ë‘ì—½ì´ ê°•ë ¥í•©ë‹ˆë‹¤ ğŸ’ª';
    else if (percentage >= 75) feedback = 'í›Œë¥­í•´ìš”! ì¶©ë™ ì¡°ì ˆì´ ì˜ ë˜ê³  ìˆì–´ìš” ğŸ‘';
    else if (percentage >= 60) feedback = 'ê´œì°®ì•„ìš”! ì¡°ê¸ˆì”© ê°œì„ í•˜ê³  ìˆì–´ìš” âœ¨';
    else feedback = 'ì—°ìŠµì´ í•„ìš”í•´ìš”. ë§¤ì¼ í›ˆë ¨í•˜ë©´ ì¢‹ì•„ì§ˆ ê±°ì˜ˆìš” ğŸŒ±';

    return (
      <div className="max-w-2xl mx-auto">
        <div className="bg-white rounded-lg p-8 shadow-sm text-center">
          <h2 className="text-2xl font-bold text-gray-800 mb-4">Decision Making ì™„ë£Œ</h2>
          <div className="mb-6">
            <p className="text-gray-600">ìµœì¢… ì ìˆ˜</p>
            <p className="text-4xl font-bold text-purple-600">{score}/{maxScore}</p>
            <p className="text-lg text-gray-700 mt-2">{percentage}%</p>
            <p className="text-sm text-gray-600 mt-3 p-3 bg-blue-50 rounded-lg">{feedback}</p>
          </div>
          <p className="text-gray-600 mb-6">ì†Œìš” ì‹œê°„: {timeTaken}ì´ˆ</p>
          <button
            onClick={() => onComplete(percentage, timeTaken)}
            className="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition"
          >
            ì™„ë£Œ
          </button>
        </div>
      </div>
    );
  }

  const scenario = scenarios[currentIndex];

  return (
    <div className="max-w-2xl mx-auto">
      <div className="bg-white rounded-lg p-8 shadow-sm">
        <h2 className="text-2xl font-bold text-gray-800 mb-2">Decision Making</h2>
        <p className="text-sm text-gray-600 mb-6">ìˆì¸ ì™€ ì¦‰ê°ì  ë³´ìƒì— ê¸¸ë“¤ì—¬ì§„ ë‡Œë¥¼ í›ˆë ¨í•©ë‹ˆë‹¤</p>

        <div className="mb-8 p-5 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border-l-4 border-purple-500">
          <p className="text-sm text-gray-600 mb-2">ìƒí™© {currentIndex + 1}</p>
          <p className="text-gray-800 font-semibold text-lg leading-relaxed">{scenario.situation}</p>
        </div>

        <div className="space-y-3 mb-8">
          <p className="text-sm text-gray-600 font-medium mb-3">ë‹¹ì‹ ì˜ ì„ íƒì€?</p>
          {scenario.options.map((option, idx) => (
            <button
              key={idx}
              onClick={() => {
                setScore(score + option.value);
                if (currentIndex >= scenarios.length - 1) {
                  setGameEnded(true);
                } else {
                  setCurrentIndex(currentIndex + 1);
                }
              }}
              className="w-full p-4 text-left bg-white hover:bg-purple-50 border-2 border-gray-200 hover:border-purple-400 rounded-lg transition-all font-medium text-gray-800 hover:shadow-md"
            >
              <span className="text-purple-600 font-bold mr-2">{String.fromCharCode(65 + idx)}.</span>
              {option.text}
            </button>
          ))}
        </div>

        <div className="w-full bg-gray-200 rounded-full h-2">
          <div className="bg-purple-600 h-2 rounded-full transition-all" style={{ width: `${((currentIndex + 1) / scenarios.length) * 100}%` }} />
        </div>
        <p className="text-sm text-gray-600 mt-2 text-center">{currentIndex + 1}/{scenarios.length}</p>
      </div>
    </div>
  );
};

// Summarization Game
const SummarizationGame = ({ onComplete }: { onComplete: (score: number, time: number, results?: any) => void }) => {
  const texts = [
    {
      text: "ì¸í„°ë„·ì€ 1960ë…„ëŒ€ êµ°ì‚¬ ë„¤íŠ¸ì›Œí¬ì¸ ARPANETì—ì„œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ˆê¸°ì—ëŠ” ëŒ€í•™ê³¼ ì—°êµ¬ê¸°ê´€ì„ ì—°ê²°í•˜ëŠ” ëª©ì ìœ¼ë¡œ ê°œë°œë˜ì—ˆìœ¼ë©°, 1980ë…„ëŒ€ ê°œì¸ìš© ì»´í“¨í„°ì˜ ë³´ê¸‰ê³¼ í•¨ê»˜ ìƒì—…í™”ë˜ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤. 1990ë…„ëŒ€ ì›”ë“œ ì™€ì´ë“œ ì›¹ì˜ ë“±ì¥ìœ¼ë¡œ ì¸í„°ë„·ì€ ê¸‰ì†ë„ë¡œ í™•ì‚°ë˜ì—ˆê³ , ì˜¤ëŠ˜ë‚  ì „ ì„¸ê³„ ìˆ˜ì‹­ì–µ ëª…ì´ ë§¤ì¼ ì¸í„°ë„·ì„ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
      keywords: ['ì¸í„°ë„·', 'ì—­ì‚¬', 'ë°œì „'],
    },
    {
      text: "ìˆ™ë©´ì€ ìš°ë¦¬ ê±´ê°•ì˜ í•„ìˆ˜ ìš”ì†Œì…ë‹ˆë‹¤. ì  ë™ì•ˆ ë‡ŒëŠ” í•˜ë£¨ ë™ì•ˆ ìŠµë“í•œ ì •ë³´ë¥¼ ì •ë¦¬í•˜ê³ , ì‹ ì²´ëŠ” ì†ìƒëœ ì„¸í¬ë¥¼ ë³µêµ¬í•©ë‹ˆë‹¤. ì¶©ë¶„í•œ ìˆ˜ë©´ì„ ì·¨í•˜ì§€ ëª»í•˜ë©´ ë©´ì—­ë ¥ì´ ì €í•˜ë˜ê³ , ì§‘ì¤‘ë ¥ê³¼ ê¸°ì–µë ¥ì´ ê°ì†Œí•˜ë©°, ì‹¬ë¦¬ì  ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ì¦ê°€í•©ë‹ˆë‹¤. ì „ë¬¸ê°€ë“¤ì€ í•˜ë£¨ 7-9ì‹œê°„ì˜ ê·œì¹™ì ì¸ ìˆ˜ë©´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.",
      keywords: ['ìˆ˜ë©´', 'ê±´ê°•', 'ì¤‘ìš”ì„±'],
    },
    {
      text: "ì‹ë¬¼ì€ ê´‘í•©ì„±ì„ í†µí•´ íƒœì–‘ì˜ ì—ë„ˆì§€ë¥¼ í™”í•™ ì—ë„ˆì§€ë¡œ ë³€í™˜í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ ë¬¼ê³¼ ì´ì‚°í™”íƒ„ì†Œë¥¼ ì´ìš©í•˜ì—¬ í¬ë„ë‹¹ì„ ë§Œë“¤ê³  ì‚°ì†Œë¥¼ ë°°ì¶œí•©ë‹ˆë‹¤. ì´ë ‡ê²Œ ìƒì‚°ëœ ì‚°ì†ŒëŠ” ì§€êµ¬ì˜ ëª¨ë“  ìƒëª…ì²´ê°€ í˜¸í¡í•˜ëŠ” ë° í•„ìˆ˜ì ì´ë©°, í¬ë„ë‹¹ì€ ì‹ë¬¼ì´ ìë¼ëŠ” ë° í•„ìš”í•œ ì—ë„ˆì§€ì›ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ì‹ë¬¼ì€ ì§€êµ¬ ìƒíƒœê³„ì˜ ê¸°ì´ˆë¥¼ ì´ë£¨ê³  ìˆìŠµë‹ˆë‹¤.",
      keywords: ['ì‹ë¬¼', 'ê´‘í•©ì„±', 'ìƒíƒœ'],
    },
  ];

  const [currentIndex, setCurrentIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [startTime] = useState(Date.now());
  const [userSummary, setUserSummary] = useState('');
  const [testEnded, setTestEnded] = useState(false);
  const [feedback, setFeedback] = useState<string | null>(null);
  const [results, setResults] = useState<GameResult[]>([]);

  if (testEnded) {
    const timeTaken = Math.round((Date.now() - startTime) / 1000);

    return (
      <div className="max-w-2xl mx-auto">
        <div className="bg-white rounded-lg p-8 shadow-sm">
          <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center">ìš”ì•½ í›ˆë ¨ ì™„ë£Œ</h2>
          
          <div className="mb-8 p-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg text-center border border-blue-200">
            <p className="text-gray-600 mb-2">ìµœì¢… ì ìˆ˜</p>
            <p className="text-4xl font-bold text-blue-600">{score}/{texts.length}</p>
            <p className="text-sm text-gray-600 mt-2">ì†Œìš” ì‹œê°„: {timeTaken}ì´ˆ</p>
          </div>

          <button
            onClick={() => onComplete(Math.round((score / texts.length) * 100), timeTaken, results)}
            className="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold"
          >
            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
          </button>
        </div>
      </div>
    );
  }

  const currentText = texts[currentIndex];

  return (
    <div className="max-w-2xl mx-auto">
      <div className="bg-white rounded-lg p-8 shadow-sm">
        <h2 className="text-2xl font-bold text-gray-800 mb-2">ìš”ì•½ í›ˆë ¨</h2>
        <p className="text-gray-600 mb-6">ì£¼ì–´ì§„ í…ìŠ¤íŠ¸ë¥¼ ì½ê³  í•µì‹¬ì„ í•œ ë¬¸ì¥(50ì ì´ë‚´)ìœ¼ë¡œ ìš”ì•½í•˜ì„¸ìš”</p>

        <div className="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
          <p className="text-gray-800 mb-4">{currentText.text}</p>
          <div className="flex gap-2 flex-wrap">
            {currentText.keywords.map((keyword, idx) => (
              <span key={idx} className="px-2 py-1 bg-blue-200 text-blue-800 rounded text-sm font-medium">
                #{keyword}
              </span>
            ))}
          </div>
        </div>

        <textarea
          value={userSummary}
          onChange={(e) => {
            if (e.target.value.length <= 50) {
              setUserSummary(e.target.value);
            }
          }}
          placeholder="ì—¬ê¸°ì— ìš”ì•½ì„ ì…ë ¥í•˜ì„¸ìš”..."
          className="w-full h-24 p-4 border border-gray-300 rounded-lg font-medium text-gray-800 focus:outline-none focus:border-blue-500 resize-none"
        />
        <p className="text-sm text-gray-600 mt-2">{userSummary.length}/50ì</p>

        {feedback && (
          <div className={`mt-4 p-3 rounded-lg font-semibold ${
            feedback.includes('ì¢‹ìŠµë‹ˆë‹¤') ? 'bg-green-50 text-green-700 border border-green-200' : 'bg-blue-50 text-blue-700 border border-blue-200'
          }`}>
            {feedback}
          </div>
        )}

        <div className="flex gap-3 mt-6">
          <button
            onClick={() => {
              if (userSummary.length < 10) {
                setFeedback('ìµœì†Œ 10ì ì´ìƒ ì‘ì„±í•´ì£¼ì„¸ìš”');
                return;
              }
              const isGood = userSummary.length > 20 && currentText.keywords.some(k => userSummary.includes(k));
              if (isGood) {
                setScore(score + 1);
              }
              setResults([...results, {
                correct: isGood,
                details: { text: currentText.text, userSummary, isGood },
              }]);

              if (currentIndex >= texts.length - 1) {
                setTestEnded(true);
              } else {
                setCurrentIndex(currentIndex + 1);
                setUserSummary('');
                setFeedback(null);
              }
            }}
            className="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold"
          >
            ë‹¤ìŒ
          </button>
        </div>

        <div className="w-full bg-gray-200 rounded-full h-2 mt-6">
          <div className="bg-blue-600 h-2 rounded-full" style={{ width: `${((currentIndex + 1) / texts.length) * 100}%` }} />
        </div>
        <p className="text-sm text-gray-600 mt-2">{currentIndex + 1}/{texts.length}</p>
      </div>
    </div>
  );
};

// Emotion Labeling Game
const EmotionLabelingGame = ({ onComplete }: { onComplete: (score: number, time: number) => void }) => {
  const scenarios = [
    {
      situation: 'ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í–ˆëŠ”ë°, ê°‘ìê¸° ë‹´ë‹¹ìê°€ ë°”ë€Œì—ˆë‹¤',
      emotions: ['ë¶ˆì•ˆ', 'í˜¼ë€', 'ë‹µë‹µí•¨'],
      correct: ['ë¶ˆì•ˆ', 'í˜¼ë€'],
    },
    {
      situation: 'ì§„ì§œ í•˜ê³  ì‹¶ë˜ ì¼ì„ ê²°êµ­ í•˜ê²Œ ë˜ì—ˆë‹¤',
      emotions: ['ê¸°ì¨', 'ìì‹ ê°', 'í¬ë§'],
      correct: ['ê¸°ì¨', 'ìì‹ ê°'],
    },
    {
      situation: 'ì¤‘ìš”í•œ íšŒì˜ì—ì„œ ì‹¤ìˆ˜ë¥¼ í–ˆê³ , ëª¨ë‘ê°€ ë´¤ë‹¤',
      emotions: ['ë¶€ë„ëŸ¬ì›€', 'ìì±…', 'ë‘ë ¤ì›€'],
      correct: ['ë¶€ë„ëŸ¬ì›€', 'ìì±…'],
    },
    {
      situation: 'ì¹œêµ¬ê°€ ì•½ì†ì„ ê¹¨ëœ¨ë ¸ë‹¤',
      emotions: ['ë¶„ë…¸', 'ë°°ì‹ ê°', 'ì™¸ë¡œì›€'],
      correct: ['ë¶„ë…¸', 'ë°°ì‹ ê°'],
    },
    {
      situation: 'ì–´ë ¤ìš´ ìƒí™©ì„ í˜¼ì í—¤ì³ë‚˜ê°”ë‹¤',
      emotions: ['ì„±ì·¨ê°', 'ìë¶€ì‹¬', 'í”¼ë¡œ'],
      correct: ['ì„±ì·¨ê°', 'ìë¶€ì‹¬'],
    },
  ];

  const [currentIndex, setCurrentIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [startTime] = useState(Date.now());
  const [selectedEmotions, setSelectedEmotions] = useState<string[]>([]);
  const [testEnded, setTestEnded] = useState(false);

  if (testEnded) {
    const timeTaken = Math.round((Date.now() - startTime) / 1000);
    return (
      <div className="max-w-2xl mx-auto">
        <div className="bg-white rounded-lg p-8 shadow-sm text-center">
          <h2 className="text-2xl font-bold text-gray-800 mb-4">ê°ì • ë¼ë²¨ë§ ì™„ë£Œ</h2>
          <div className="mb-6">
            <p className="text-gray-600">ìµœì¢… ì ìˆ˜</p>
            <p className="text-4xl font-bold text-purple-600">{score}/{scenarios.length}</p>
          </div>
          <p className="text-gray-600 mb-6">ì†Œìš” ì‹œê°„: {timeTaken}ì´ˆ</p>
          <button
            onClick={() => onComplete(Math.round((score / scenarios.length) * 100), timeTaken)}
            className="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-semibold"
          >
            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
          </button>
        </div>
      </div>
    );
  }

  const scenario = scenarios[currentIndex];

  return (
    <div className="max-w-2xl mx-auto">
      <div className="bg-white rounded-lg p-8 shadow-sm">
        <h2 className="text-2xl font-bold text-gray-800 mb-2">ê°ì • ë¼ë²¨ë§</h2>
        <p className="text-gray-600 mb-6">ìƒí™©ì—ì„œ ëŠê»´ì§ˆ ìˆ˜ ìˆëŠ” ê°ì •ë“¤ì„ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš” (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</p>

        <div className="mb-8 p-4 bg-purple-50 rounded-lg border-l-4 border-purple-500">
          <p className="text-gray-800 font-semibold">{scenario.situation}</p>
        </div>

        <div className="grid grid-cols-2 gap-3 mb-6">
          {scenario.emotions.map((emotion, idx) => (
            <button
              key={idx}
              onClick={() => {
                if (selectedEmotions.includes(emotion)) {
                  setSelectedEmotions(selectedEmotions.filter(e => e !== emotion));
                } else {
                  setSelectedEmotions([...selectedEmotions, emotion]);
                }
              }}
              className={`p-4 rounded-lg font-semibold transition border-2 ${
                selectedEmotions.includes(emotion)
                  ? 'bg-purple-600 text-white border-purple-600'
                  : 'bg-white text-gray-800 border-gray-300 hover:border-purple-300'
              }`}
            >
              {emotion}
            </button>
          ))}
        </div>

        <button
          onClick={() => {
            const isCorrect = 
              selectedEmotions.length === scenario.correct.length &&
              selectedEmotions.every(e => scenario.correct.includes(e));
            
            if (isCorrect) {
              setScore(score + 1);
            }

            if (currentIndex >= scenarios.length - 1) {
              setTestEnded(true);
            } else {
              setCurrentIndex(currentIndex + 1);
              setSelectedEmotions([]);
            }
          }}
          disabled={selectedEmotions.length === 0}
          className="w-full px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 transition font-semibold"
        >
          í™•ì¸
        </button>

        <div className="w-full bg-gray-200 rounded-full h-2 mt-6">
          <div className="bg-purple-600 h-2 rounded-full" style={{ width: `${((currentIndex + 1) / scenarios.length) * 100}%` }} />
        </div>
        <p className="text-sm text-gray-600 mt-2">{currentIndex + 1}/{scenarios.length}</p>
      </div>
    </div>
  );
};

// Breathing Meditation
const BreathingMeditation = ({ onComplete }: { onComplete: (score: number, time: number) => void }) => {
  const [timeLeft, setTimeLeft] = useState(60);
  const [isRunning, setIsRunning] = useState(false);
  const [phase, setPhase] = useState<'ready' | 'inhale' | 'hold' | 'exhale'>('ready');
  const [cycles, setCycles] = useState(0);

  useEffect(() => {
    if (!isRunning) return;

    const interval = setInterval(() => {
      setTimeLeft(prev => {
        if (prev <= 0) {
          setIsRunning(false);
          return 0;
        }
        return prev - 1;
      });
    }, 1000);

    return () => clearInterval(interval);
  }, [isRunning]);

  useEffect(() => {
    if (!isRunning || phase === 'ready') return;

    let timer: NodeJS.Timeout;
    if (phase === 'inhale') {
      timer = setTimeout(() => setPhase('hold'), 4000);
    } else if (phase === 'hold') {
      timer = setTimeout(() => setPhase('exhale'), 4000);
    } else if (phase === 'exhale') {
      timer = setTimeout(() => {
        setCycles(cycles + 1);
        setPhase('inhale');
      }, 4000);
    }

    return () => clearTimeout(timer);
  }, [isRunning, phase, cycles]);

  if (timeLeft === 0) {
    const timeTaken = 60;
    return (
      <div className="max-w-2xl mx-auto">
        <div className="bg-white rounded-lg p-8 shadow-sm text-center">
          <h2 className="text-2xl font-bold text-gray-800 mb-4">í˜¸í¡ ëª…ìƒ ì™„ë£Œ</h2>
          <div className="mb-6">
            <p className="text-gray-600 mb-2">ì™„ë£Œí•œ í˜¸í¡ ì‚¬ì´í´</p>
            <p className="text-4xl font-bold text-green-600">{cycles}</p>
          </div>
          <p className="text-gray-600 mb-6">ì¶•í•˜í•©ë‹ˆë‹¤! ì „ë‘ì—½ì˜ 'ì£¼ì˜ ì œì–´ë ¥'ì„ í›ˆë ¨í–ˆìŠµë‹ˆë‹¤ ğŸ§˜</p>
          <button
            onClick={() => onComplete(cycles * 20, timeTaken)}
            className="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold"
          >
            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="max-w-2xl mx-auto">
      <div className="bg-white rounded-lg p-8 shadow-sm text-center">
        <h2 className="text-2xl font-bold text-gray-800 mb-2">í˜¸í¡ ëª…ìƒ</h2>
        <p className="text-gray-600 mb-8">4-4-4 í˜¸í¡ë²•: ë“¤ìˆ¨(4ì´ˆ) â†’ ë©ˆì¶¤(4ì´ˆ) â†’ ë‚ ìˆ¨(4ì´ˆ)</p>

        <div className="mb-8 p-8 bg-gradient-to-br from-green-50 to-blue-50 rounded-lg border-2 border-green-200 min-h-96 flex flex-col items-center justify-center">
          {!isRunning && phase === 'ready' && (
            <div>
              <p className="text-lg text-gray-700 mb-4">í¸ì•ˆí•œ ìì„¸ë¡œ ì•‰ìœ¼ì„¸ìš”</p>
              <p className="text-5xl font-bold text-green-600 mb-8">ğŸ§˜</p>
            </div>
          )}

          {isRunning && (
            <>
              <div className="text-6xl font-bold text-green-600 mb-8">
                {phase === 'inhale' && 'ë“¤ìˆ¨'}
                {phase === 'hold' && 'ë©ˆì¶¤'}
                {phase === 'exhale' && 'ë‚ ìˆ¨'}
              </div>
              <div className="w-32 h-32 rounded-full border-4 border-green-500 flex items-center justify-center mb-8 animate-pulse">
                <span className="text-4xl font-bold text-green-600">âœ“</span>
              </div>
            </>
          )}

          <div className="text-sm text-gray-600 mt-auto pt-8">
            ì‚¬ì´í´: {cycles} / ë‚¨ì€ ì‹œê°„: {timeLeft}ì´ˆ
          </div>
        </div>

        <button
          onClick={() => setIsRunning(!isRunning)}
          className={`px-8 py-4 text-lg font-semibold rounded-lg transition ${
            isRunning
              ? 'bg-red-600 text-white hover:bg-red-700'
              : 'bg-green-600 text-white hover:bg-green-700'
          }`}
        >
          {isRunning ? 'ì¼ì‹œì •ì§€' : 'ì‹œì‘'}
        </button>
      </div>
    </div>
  );
};

// IF-THEN Planning
const IfThenPlanning = ({ onComplete }: { onComplete: (score: number, time: number) => void }) => {
  const scenarios = [
    {
      trigger: 'í™”ê°€ ë‚  ë•Œ',
      options: [
        { text: 'ì‹¬í˜¸í¡ì„ 3ë²ˆ í•œë‹¤', score: 10 },
        { text: 'ë°”ë¡œ ë§í•œë‹¤', score: 1 },
        { text: 'í° ì†Œë¦¬ë¥¼ ë‚¸ë‹¤', score: 0 },
      ],
    },
    {
      trigger: 'ì§‘ì¤‘ë ¥ì´ ë–¨ì–´ì§ˆ ë•Œ',
      options: [
        { text: 'í•¸ë“œí°ì„ í™•ì¸í•œë‹¤', score: 0 },
        { text: 'ë‹¤ì‹œ ì‘ì—…ì— ì§‘ì¤‘í•œë‹¤', score: 10 },
        { text: 'ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ”ë‹¤', score: 1 },
      ],
    },
    {
      trigger: 'ì–´ë ¤ìš´ ê²°ì •ì„ í•´ì•¼ í•  ë•Œ',
      options: [
        { text: 'ì‹œê°„ì„ ê°€ì§€ê³  ìƒê°í•œë‹¤', score: 10 },
        { text: 'ê¸‰í•˜ê²Œ ê²°ì •í•œë‹¤', score: 1 },
        { text: 'ëˆ„êµ°ê°€ì˜ ì˜ê²¬ë§Œ ë”°ë¥¸ë‹¤', score: 2 },
      ],
    },
    {
      trigger: 'ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ì„ ë•Œ',
      options: [
        { text: 'ìš´ë™í•˜ê±°ë‚˜ ì‚°ì±…í•œë‹¤', score: 10 },
        { text: 'í­ì‹í•œë‹¤', score: 1 },
        { text: 'ëˆ„êµ°ê°€ì—ê²Œ í™”í’€ì´í•œë‹¤', score: 0 },
      ],
    },
    {
      trigger: 'ì‹¤ìˆ˜ë¥¼ í–ˆì„ ë•Œ',
      options: [
        { text: 'ì´ìœ ë¥¼ ë¶„ì„í•˜ê³  ê°œì„ í•œë‹¤', score: 10 },
        { text: 'ìì‹ ì„ ì±…ë§í•œë‹¤', score: 3 },
        { text: 'ë¬´ì‹œí•˜ê³  ë„˜ì–´ê°„ë‹¤', score: 1 },
      ],
    },
  ];

  const [currentIndex, setCurrentIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [startTime] = useState(Date.now());
  const [testEnded, setTestEnded] = useState(false);

  if (testEnded) {
    const timeTaken = Math.round((Date.now() - startTime) / 1000);
    return (
      <div className="max-w-2xl mx-auto">
        <div className="bg-white rounded-lg p-8 shadow-sm text-center">
          <h2 className="text-2xl font-bold text-gray-800 mb-4">IF-THEN í”Œë˜ë‹ ì™„ë£Œ</h2>
          <div className="mb-6">
            <p className="text-gray-600">ìµœì¢… ì ìˆ˜</p>
            <p className="text-4xl font-bold text-orange-600">{score}/50</p>
          </div>
          <p className="text-gray-600 mb-6">ì†Œìš” ì‹œê°„: {timeTaken}ì´ˆ</p>
          <p className="text-sm text-gray-600 mb-6">ğŸ’¡ ê°ì •ì´ í­ë°œí•˜ê¸° ì „ ì „ë‘ì—½ì´ ê°œì…í•  ì‹œê°„ì„ ë²Œì–´ì£¼ëŠ” í›ˆë ¨ì…ë‹ˆë‹¤</p>
          <button
            onClick={() => onComplete(Math.round((score / 50) * 100), timeTaken)}
            className="px-6 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition font-semibold"
          >
            ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
          </button>
        </div>
      </div>
    );
  }

  const scenario = scenarios[currentIndex];

  return (
    <div className="max-w-2xl mx-auto">
      <div className="bg-white rounded-lg p-8 shadow-sm">
        <h2 className="text-2xl font-bold text-gray-800 mb-2">IF-THEN í”Œë˜ë‹</h2>
        <p className="text-gray-600 mb-6">ìƒí™©ì—ì„œ 'ì „ë‘ì—½'ì´ ì¢‹ì•„í•  í–‰ë™ì„ ì„ íƒí•˜ì„¸ìš”</p>

        <div className="mb-8 p-4 bg-orange-50 rounded-lg border-l-4 border-orange-500">
          <p className="text-gray-600 text-sm mb-2">ìƒí™©</p>
          <p className="text-gray-800 font-bold text-lg">{scenario.trigger}</p>
        </div>

        <div className="space-y-3 mb-6">
          {scenario.options.map((option, idx) => (
            <button
              key={idx}
              onClick={() => {
                setScore(score + option.score);
                if (currentIndex >= scenarios.length - 1) {
                  setTestEnded(true);
                } else {
                  setCurrentIndex(currentIndex + 1);
                }
              }}
              className="w-full p-4 text-left bg-gray-50 hover:bg-orange-50 border-2 border-gray-200 hover:border-orange-300 rounded-lg transition font-medium text-gray-800 hover:text-orange-700"
            >
              THEN {option.text}
            </button>
          ))}
        </div>

        <div className="w-full bg-gray-200 rounded-full h-2">
          <div className="bg-orange-600 h-2 rounded-full" style={{ width: `${((currentIndex + 1) / scenarios.length) * 100}%` }} />
        </div>
        <p className="text-sm text-gray-600 mt-2">{currentIndex + 1}/{scenarios.length}</p>
      </div>
    </div>
  );
};

// Game Details View
const GameDetailsView = ({ game, onBack, onRetry }: { game: any; onBack: () => void; onRetry: (gameId: string) => void }) => {
  const getGameTitle = (id: GameType) => {
    switch(id) {
      case 'stroop': return 'Stroop Test';
      case 'nback': return 'N-back Game';
      case 'decision': return 'Decision Making';
      case 'summarization': return 'ìš”ì•½ í›ˆë ¨';
      case 'emotion': return 'ê°ì • ë¼ë²¨ë§';
      case 'breathing': return 'í˜¸í¡ ëª…ìƒ';
      case 'ifThen': return 'IF-THEN í”Œë˜ë‹';
    }
  };

  return (
    <div className="max-w-2xl mx-auto">
      <div className="bg-white rounded-lg p-6 shadow-sm">
        <button
          onClick={onBack}
          className="mb-6 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition"
        >
          â† ëŒì•„ê°€ê¸°
        </button>

        <h2 className="text-2xl font-bold text-gray-800 mb-2">{getGameTitle(game.id)}</h2>
        
        <div className="grid grid-cols-3 gap-4 mb-6">
          <div className="p-3 bg-purple-50 rounded-lg text-center border border-purple-200">
            <p className="text-xs text-gray-600">ì ìˆ˜</p>
            <p className="text-2xl font-bold text-purple-600">{game.score}</p>
          </div>
          <div className="p-3 bg-blue-50 rounded-lg text-center border border-blue-200">
            <p className="text-xs text-gray-600">ì†Œìš”ì‹œê°„</p>
            <p className="text-2xl font-bold text-blue-600">{game.time}ì´ˆ</p>
          </div>
          <div className="p-3 bg-green-50 rounded-lg text-center border border-green-200">
            <p className="text-xs text-gray-600">ì •ë‹µë¥ </p>
            <p className="text-2xl font-bold text-green-600">
              {game.results ? Math.round((game.results.filter((r: any) => r.correct).length / game.results.length) * 100) : 0}%
            </p>
          </div>
        </div>

        {game.results && (
          <div>
            <h3 className="font-semibold text-gray-800 mb-4">ë¬¸ì œë³„ ì •ë‹µ ê²°ê³¼</h3>
            <div className="space-y-3">
              {game.results.map((result: any, idx: number) => (
                <div
                  key={idx}
                  className={`p-4 rounded-lg border-l-4 ${
                    result.correct
                      ? 'bg-green-50 border-l-green-500'
                      : 'bg-red-50 border-l-red-500'
                  }`}
                >
                  <div className="flex items-center justify-between mb-2">
                    <span className="font-medium text-gray-800">ë¬¸ì œ {idx + 1}</span>
                    <span className={result.correct ? 'text-green-600 font-semibold' : 'text-red-600 font-semibold'}>
                      {result.correct ? 'âœ“ ì •ë‹µ' : 'âœ— ì˜¤ë‹µ'}
                    </span>
                  </div>
                  <p className="text-sm text-gray-700">
                    {game.id === 'stroop' && `ìƒ‰ìƒ: ${result.details.displayColor}`}
                    {!result.correct && game.id === 'stroop' && ` â†’ ì •ë‹µ: ${result.details.textColorName}`}
                  </p>
                </div>
              ))}
            </div>
          </div>
        )}

        <div className="flex gap-3 mt-8">
          <button
            onClick={() => onRetry(game.id)}
            className="flex-1 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-semibold"
          >
            ğŸ”„ ë‹¤ì‹œí•˜ê¸°
          </button>
          <button
            onClick={onBack}
            className="flex-1 px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition font-semibold"
          >
            ë‹«ê¸°
          </button>
        </div>
      </div>
    </div>
  );
};

// Pomodoro Timer
const PomodoroTimer = () => {
  const [workDuration] = useState(25);
  const [breakDuration] = useState(5);
  const [isRunning, setIsRunning] = useState(false);
  const [isWorkSession, setIsWorkSession] = useState(true);
  const [timeLeft, setTimeLeft] = useState(workDuration * 60);

  useEffect(() => {
    let interval: NodeJS.Timeout | undefined;
    if (isRunning && timeLeft > 0) {
      interval = setInterval(() => {
        setTimeLeft(timeLeft - 1);
      }, 1000);
    } else if (timeLeft === 0) {
      setIsWorkSession(!isWorkSession);
      setTimeLeft((!isWorkSession ? workDuration : breakDuration) * 60);
    }
    return () => clearInterval(interval);
  }, [isRunning, timeLeft, isWorkSession, workDuration, breakDuration]);

  const minutes = Math.floor(timeLeft / 60);
  const seconds = timeLeft % 60;

  return (
    <div className="max-w-2xl mx-auto">
      <div className="bg-white rounded-lg p-8 shadow-sm text-center">
        <h2 className="text-2xl font-bold text-gray-800 mb-4">í¬ëª¨ë„ë¡œ íƒ€ì´ë¨¸</h2>
        
        <div className="mb-8 p-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg">
          <p className="text-lg text-gray-600 mb-4">{isWorkSession ? 'ì§‘ì¤‘ ì‹œê°„' : 'íœ´ì‹ ì‹œê°„'}</p>
          <div className="text-6xl font-bold text-gray-800 font-mono mb-4">
            {String(minutes).padStart(2, '0')}:{String(seconds).padStart(2, '0')}
          </div>
        </div>

        <div className="flex gap-3 justify-center mb-6">
          <button
            onClick={() => setIsRunning(!isRunning)}
            className="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-semibold"
          >
            {isRunning ? 'ì¼ì‹œì •ì§€' : 'ì‹œì‘'}
          </button>
          <button
            onClick={() => {
              setIsRunning(false);
              setTimeLeft(workDuration * 60);
              setIsWorkSession(true);
            }}
            className="px-6 py-3 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition font-semibold"
          >
            ë¦¬ì…‹
          </button>
        </div>

        <p className="text-sm text-gray-600">
          ğŸ’¡ ì§‘ì¤‘ì´ í•„ìš”í•  ë•Œë§ˆë‹¤ í¬ëª¨ë„ë¡œë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. 25ë¶„ ì§‘ì¤‘ â†’ 5ë¶„ íœ´ì‹ ë°˜ë³µ
        </p>
      </div>
    </div>
  );
};

// Statistics View
const StatisticsView = ({ userStats }: { userStats: any }) => {
  return (
    <div className="space-y-6">
      <div className="bg-white rounded-lg p-6 shadow-sm">
        <h2 className="text-2xl font-bold text-gray-800 mb-6">í†µê³„</h2>
        
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          <div className="p-4 bg-gradient-to-br from-red-50 to-orange-50 rounded-lg border border-red-100">
            <p className="text-sm text-gray-600 mb-2">ğŸ”¥ í˜„ì¬ ì—°ì† ì™„ë£Œ</p>
            <p className="text-4xl font-bold text-red-600">{userStats.streak}</p>
            <p className="text-xs text-gray-600 mt-2">ì¼</p>
          </div>
          <div className="p-4 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-lg border border-blue-100">
            <p className="text-sm text-gray-600 mb-2">âœ… ì´ ì™„ë£Œ ì„¸ì…˜</p>
            <p className="text-4xl font-bold text-blue-600">{userStats.totalSessionsCompleted}</p>
            <p className="text-xs text-gray-600 mt-2">ì„¸ì…˜</p>
          </div>
        </div>

        <div className="border-t pt-6">
          <h3 className="font-semibold text-gray-800 mb-4">ê° ê²Œì„ë³„ ìµœê·¼ ì ìˆ˜</h3>
          <div className="space-y-4">
            {Object.entries(userStats.scores).map(([game, scores]: [string, any]) => (
              <div key={game}>
                <p className="text-sm font-medium text-gray-700 mb-2">
                  {game === 'stroop' ? 'Stroop Test' : game === 'nback' ? 'N-back Game' : game === 'decision' ? 'Decision Making' : game === 'summarization' ? 'ìš”ì•½ í›ˆë ¨' : game === 'emotion' ? 'ê°ì • ë¼ë²¨ë§' : game === 'breathing' ? 'í˜¸í¡ ëª…ìƒ' : 'IF-THEN í”Œë˜ë‹'}
                </p>
                <div className="flex gap-2 flex-wrap">
                  {scores.slice(-5).map((score: number, idx: number) => (
                    <div
                      key={idx}
                      className="px-3 py-1 bg-purple-100 text-purple-700 text-sm rounded-full font-medium"
                    >
                      {score}
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>

      <div className="bg-white rounded-lg p-6 shadow-sm">
        <h3 className="font-semibold text-gray-800 mb-4">ğŸ’¡ íŒ</h3>
        <ul className="space-y-2 text-sm text-gray-700">
          <li>â€¢ ë§¤ì¼ ê°™ì€ ì‹œê°„ì— í›ˆë ¨ì„ í•˜ë©´ íš¨ê³¼ê°€ ì¢‹ìŠµë‹ˆë‹¤</li>
          <li>â€¢ ì—°ì† ì™„ë£Œë¥¼ í†µí•´ ë™ê¸°ë¶€ì—¬ë¥¼ ìœ ì§€í•˜ì„¸ìš”</li>
          <li>â€¢ ê° ê²Œì„ì˜ ì ìˆ˜ê°€ ì˜¬ë¼ê°ˆìˆ˜ë¡ ì „ë‘ì—½ì´ ê°•í™”ë˜ê³  ìˆìŠµë‹ˆë‹¤</li>
          <li>â€¢ ìˆì¸  ì‹œì²­ ì‹œê°„ì„ ì¤„ì´ê³  ì´ í›ˆë ¨ìœ¼ë¡œ ëŒ€ì²´í•´ë³´ì„¸ìš”</li>
        </ul>
      </div>
    </div>
  );
};

export default BrainDaily;